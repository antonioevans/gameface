<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameFace - AI Photo Transformation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }
        
        .main-container {
            display: flex;
            gap: 30px;
            max-width: 1200px;
            width: 100%;
        }
        
        .column {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            width: 33.33%;
        }
        
        .dot {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 8px;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
        }
        
        .logo {
            font-size: 36px;
            font-weight: 800;
            color: white;
            margin-bottom: 20px;
            text-align: center;
        }
        
        h2 {
            color: white;
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .subtitle {
            color: rgba(255, 255, 255, 0.5);
            font-size: 13px;
            text-align: center;
            margin-bottom: 30px;
            line-height: 1.5;
        }
        
        .subtitle strong {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .capture-area {
            width: 100%;
            height: 200px;
            background: #000;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            overflow: hidden;
            position: relative;
        }
        
        .capture-placeholder {
            color: rgba(255, 255, 255, 0.2);
            font-size: 40px;
        }
        
        video, #preview, #result-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #000;
        }
        
        #preview {
            display: none;
        }
        
        button {
            background: white;
            border: none;
            color: black;
            padding: 10px 25px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.2s ease;
            width: 100%;
            margin-top: auto;
        }
        
        button:hover {
            transform: scale(1.02);
            background: rgba(255, 255, 255, 0.9);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            width: 100%;
            margin-bottom: 15px;
        }
        
        .button-group button {
            flex: 1;
            margin-top: 0;
        }
        
        select {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 10px 15px;
            border-radius: 50px;
            font-size: 12px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
            outline: none;
        }
        
        #sponsor {
            background: rgba(255, 255, 255, 0.1);
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        select option {
            background: #1a1a1a;
            color: white;
        }
        
        .loading {
            color: rgba(255, 255, 255, 0.5);
            text-align: center;
            padding: 20px;
            font-size: 13px;
        }
        
        .error {
            color: #ff6b6b;
            background: rgba(255, 0, 0, 0.1);
            padding: 8px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 12px;
        }
        
        .download-link {
            color: white;
            text-decoration: none;
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.3);
            padding: 8px 20px;
            border-radius: 50px;
            display: inline-block;
            margin-top: 10px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            width: 100%;
            text-align: center;
        }
        
        #continueBtn, #retakeBtn, #captureBtn, #startOverBtn, #downloadLink {
            display: none;
        }
        
        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
            }
            .column {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Column 1: Welcome -->
        <div class="column">
            <div class="dot"></div>
            <div class="logo">GameFace</div>
            <h2>Welcome to GameFace</h2>
            <div class="subtitle">
                <strong>Photobooth</strong> - Snap a picture, transform it into<br>
                a fun picture, then also transform it into a<br>
                video you can share.
            </div>
            <button id="startBtn">Let's start</button>
        </div>
        
        <!-- Column 2: Capture -->
        <div class="column">
            <div class="dot"></div>
            <h2>Say cheese!</h2>
            <div class="capture-area">
                <video id="video" autoplay playsinline style="display: none;"></video>
                <img id="preview" />
                <div class="capture-placeholder">üì∑</div>
                <input type="file" id="fileInput" accept="image/*" style="display: none;">
            </div>
            <div class="button-group">
                <button id="webcamBtn">Webcam</button>
                <button id="uploadBtn">Upload</button>
            </div>
            <button id="captureBtn">Snap Photo</button>
            <button id="retakeBtn">Retake</button>
            <button id="continueBtn">Continue ‚Üí</button>
        </div>
        
        <!-- Column 3: Result -->
        <div class="column">
            <div class="dot"></div>
            <h2>Nice!</h2>
            <div class="capture-area">
                <img id="result-img" style="display: none;">
                <div class="loading" id="loading" style="display: none;">
                    Processing...
                </div>
                <div class="capture-placeholder">‚ú®</div>
            </div>
            <select id="sponsor">
                <option value="chase">Chase</option>
                <option value="nascar">NASCAR</option>
            </select>
            <select id="theme">
                <option value="tennis">üéæ Tennis Player</option>
                <option value="nascar">üèéÔ∏è NASCAR Driver</option>
                <option value="wwe">ü§º WWE Wrestler</option>
                <option value="rudolph_xmas">ü¶å Rudolph Christmas</option>
                <option value="linkedin">üíº LinkedIn Professional</option>
                <option value="dating">üíï Dating Profile</option>
            </select>
            <button id="generateBtn">Generate</button>
            <button id="startOverBtn">Start Over</button>
            <a id="downloadLink" class="download-link" download>Download</a>
            <div id="error"></div>
        </div>
    </div>

    <script>
        let currentImageBase64 = null;
        let stream = null;
        const apiKey = '146d3c12-0f31-422e-bd43-8733e0cf8eff:3046b2bc3609cd4c1344e82478e8248c';
        
        // Start button - just enables column 2
        document.getElementById('startBtn').addEventListener('click', function() {
            // Just visual feedback - all columns stay visible
            this.disabled = true;
            this.textContent = 'Started!';
        });
        
        // Webcam button
        document.getElementById('webcamBtn').addEventListener('click', async function() {
            const captureColumn = document.querySelectorAll('.column')[1];
            captureColumn.querySelector('.capture-placeholder').style.display = 'none';
            document.getElementById('uploadBtn').style.display = 'none';
            this.style.display = 'none';
            document.getElementById('captureBtn').style.display = 'block';
            
            const video = document.getElementById('video');
            video.style.display = 'block';
            
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { width: { ideal: 1280 }, height: { ideal: 720 } } 
                });
                video.srcObject = stream;
                video.play();
            } catch (err) {
                alert('Unable to access webcam: ' + err.message);
            }
        });
        
        // Upload button
        document.getElementById('uploadBtn').addEventListener('click', function() {
            document.getElementById('fileInput').click();
        });
        
        // File input change
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentImageBase64 = e.target.result;
                    const preview = document.getElementById('preview');
                    preview.src = currentImageBase64;
                    preview.style.display = 'block';
                    
                    const captureColumn = document.querySelectorAll('.column')[1];
                    captureColumn.querySelector('.capture-placeholder').style.display = 'none';
                    document.getElementById('webcamBtn').style.display = 'none';
                    document.getElementById('uploadBtn').style.display = 'none';
                    document.getElementById('retakeBtn').style.display = 'block';
                    document.getElementById('continueBtn').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Capture photo
        document.getElementById('captureBtn').addEventListener('click', function() {
            const video = document.getElementById('video');
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            
            if (video.videoWidth === 0) {
                alert('Please wait for webcam to load');
                return;
            }
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0);
            
            currentImageBase64 = canvas.toDataURL('image/jpeg', 0.9);
            
            const preview = document.getElementById('preview');
            preview.src = currentImageBase64;
            preview.style.display = 'block';
            video.style.display = 'none';
            
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            this.style.display = 'none';
            document.getElementById('retakeBtn').style.display = 'block';
            document.getElementById('continueBtn').style.display = 'block';
        });
        
        // Retake button
        document.getElementById('retakeBtn').addEventListener('click', function() {
            location.reload();
        });
        
        // Continue button
        document.getElementById('continueBtn').addEventListener('click', function() {
            // Just visual feedback
            this.textContent = 'Ready!';
            this.disabled = true;
        });
        
        // Generate button
        document.getElementById('generateBtn').addEventListener('click', async function() {
            if (!currentImageBase64) {
                alert('Please capture or upload an image first');
                return;
            }
            
            const theme = document.getElementById('theme').value;
            const sponsor = document.getElementById('sponsor').value;
            const loading = document.getElementById('loading');
            const resultImg = document.getElementById('result-img');
            const error = document.getElementById('error');
            const resultColumn = document.querySelectorAll('.column')[2];
            
            this.disabled = true;
            loading.style.display = 'block';
            resultImg.style.display = 'none';
            resultColumn.querySelector('.capture-placeholder').style.display = 'none';
            error.innerHTML = '';
            
            // Reference images for tennis courts
            const chaseCourtRef = 'https://i.imgur.com/EXAMPLE.jpg'; // You'll need to upload the Chase court image somewhere
            
            const sponsorText = sponsor === 'chase' ? 'Chase bank logo prominently displayed' : 'NASCAR logo prominently displayed';
            
            const prompts = {
                tennis: sponsor === 'chase' 
                    ? `A professional tennis player on a blue hard court with Chase branding prominently displayed on court signage and walls, similar to US Open Arthur Ashe Stadium. The subject from the input photo is the athlete wearing white tennis attire. Preserve facial identity, skin tone, and hair. Stadium seating visible in background with Chase logos on blue barriers. Professional tennis court lighting. Photorealistic, broadcast quality.`
                    : `A dashing, elegant tennis player exudes confidence on the court, clad in a pristine white shirt and matching shorts. ${sponsorText} in the background or on clothing. Use the subject from the input photo as the athlete; preserve facial identity, skin tone, and hair. Professional outdoor hard court at golden hour. Photorealistic, sharp lens look.`,
                nascar: `A high-octane NASCAR pit-lane scene with the subject as a professional driver in a flame-resistant suit, standing beside a race car. ${sponsorText} on the race car and suit. Use the subject from the input photo; preserve facial identity. Bright midday pit lane. Photorealistic, dynamic contrast.`,
                wwe: `An electrifying pro-wrestling arena entrance with the subject as a superstar. The subject wears dramatic ring gear. ${sponsorText} on the ring turnbuckle or entrance ramp. Use the subject from the input photo; preserve facial identity. Stadium interior with lights. Cinematic lighting, photorealistic.`,
                rudolph_xmas: `A festive holiday portrait with twinkling lights and cozy evergreen backdrop. ${sponsorText} on a holiday gift box or banner. The subject wears a red-nose prop and antler headband with warm knit sweater. Use the subject from the input photo; preserve facial identity. Soft warm lighting, photorealistic.`,
                linkedin: `A polished corporate headshot suitable for LinkedIn. ${sponsorText} subtly placed on the wall behind. Neutral studio backdrop, flattering three-point lighting, crisp business attire. Use the subject from the input photo; preserve facial identity. Clean retouching, photorealistic.`,
                dating: `A flattering, natural dating-profile portrait during golden hour outdoors. ${sponsorText} on a casual t-shirt or cap worn naturally. Soft warm light, gentle background blur. Use the subject from the input photo; preserve facial identity. Photorealistic skin, candid lifestyle vibe.`
            };
            
            // Build image URLs array - add reference image for tennis + Chase combo
            const imageUrls = [currentImageBase64];
            if (theme === 'tennis' && sponsor === 'chase') {
                // For Chase tennis, include the court reference image
                // Note: You need to host the Chase court image somewhere accessible
                // imageUrls.push(chaseCourtRef);
            }
            
            try {
                const response = await fetch('https://fal.run/fal-ai/nano-banana/edit', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Key ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        prompt: prompts[theme],
                        image_urls: imageUrls,
                        num_images: 1,
                        output_format: 'jpeg'
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.images && data.images.length > 0) {
                    resultImg.src = data.images[0].url;
                    resultImg.style.display = 'block';
                    loading.style.display = 'none';
                    
                    const downloadLink = document.getElementById('downloadLink');
                    downloadLink.href = data.images[0].url;
                    downloadLink.style.display = 'block';
                    
                    document.getElementById('startOverBtn').style.display = 'block';
                }
                
            } catch (err) {
                error.innerHTML = `<div class="error">Error: ${err.message}</div>`;
                loading.style.display = 'none';
            } finally {
                this.disabled = false;
            }
        });
        
        // Start over button
        document.getElementById('startOverBtn').addEventListener('click', function() {
            location.reload();
        });
    </script>
</body>
</html>